{"version":3,"file":"index.js","sources":["../src/ccenter.ts"],"sourcesContent":["import { NextObserver, Subject } from 'rxjs';\r\n\r\nexport const GLOBAL_NAME = '__$CCenter__';\r\nexport const EVENT_COLLECTION_NAME = '__events__';\r\nexport const STATE_COLLECTION_NAME = '__states__';\r\n\r\nexport interface State {\r\n  value: any;\r\n  observable: Subject<any>;\r\n}\r\n\r\nfunction checkCCenterStatus() {\r\n  if (!window[GLOBAL_NAME]) {\r\n    const errorMsg = 'CCenter没有初始化';\r\n    console.error(errorMsg);\r\n    throw new Error(errorMsg);\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function getEventByName(name: string): Subject<any> | undefined {\r\n  return window[GLOBAL_NAME][EVENT_COLLECTION_NAME][name];\r\n}\r\n\r\nexport function getStateByName(name: string): State | undefined {\r\n  return window[GLOBAL_NAME][STATE_COLLECTION_NAME][name];\r\n}\r\n\r\nexport function init() {\r\n  if (window[GLOBAL_NAME]) {\r\n    console.warn('CCenter已经初始化，请不要重复初始化');\r\n    return;\r\n  }\r\n  window[GLOBAL_NAME] = {\r\n    [EVENT_COLLECTION_NAME]: {},\r\n    [STATE_COLLECTION_NAME]: {},\r\n  };\r\n}\r\n\r\nexport function registerEvent(name: string) {\r\n  checkCCenterStatus();\r\n  if (getEventByName(name)) {\r\n    console.error(`事件\"${name}\"已存在，不能重复注册。`);\r\n    return;\r\n  }\r\n  const subject = new Subject();\r\n  window[GLOBAL_NAME][EVENT_COLLECTION_NAME][name] = subject;\r\n  return subject;\r\n}\r\n\r\nexport function registerState(name: string, value: any = null) {\r\n  checkCCenterStatus();\r\n  if (getStateByName(name)) {\r\n    console.error(`State\"${name}\"已存在，不能重复注册。`);\r\n    return;\r\n  }\r\n  const state: State = {\r\n    value,\r\n    observable: new Subject(),\r\n  };\r\n  window[GLOBAL_NAME][STATE_COLLECTION_NAME][name] = state;\r\n  return state;\r\n}\r\n\r\nexport function subscribeEvent(name: string, next: (value: any) => void) {\r\n  checkCCenterStatus();\r\n  const event = getEventByName(name);\r\n  if (!event) {\r\n    const errorMsg = `Event: ${name} 不存在`;\r\n    console.error(errorMsg);\r\n    return undefined;\r\n  }\r\n  const subscription = event.subscribe(next);\r\n  return {\r\n    unsubscribe: () => {\r\n      subscription.unsubscribe();\r\n    },\r\n  };\r\n}\r\n\r\nexport function dispatchEvent(name: string, payload: any) {\r\n  checkCCenterStatus();\r\n  const event = getEventByName(name);\r\n  if (!event) {\r\n    const errorMsg = `Event: ${name} 不存在`;\r\n    console.error(errorMsg);\r\n    return new Error(errorMsg);\r\n  }\r\n  event.next(payload);\r\n}\r\n\r\nexport function removeEvent(name: string) {\r\n  checkCCenterStatus();\r\n  const event = getEventByName(name);\r\n  if (!event) {\r\n    const errorMsg = `Event: ${name} 不存在`;\r\n    console.error(errorMsg);\r\n    return new Error(errorMsg);\r\n  }\r\n  window[GLOBAL_NAME][EVENT_COLLECTION_NAME][name] = undefined;\r\n}\r\n\r\nexport function getState(name: string) {\r\n  checkCCenterStatus();\r\n  const state = getStateByName(name);\r\n  if (!state) {\r\n    const errorMsg = `State: ${name} 不存在`;\r\n    console.error(errorMsg);\r\n    return undefined;\r\n  }\r\n  return state.value;\r\n}\r\n\r\nexport function subscribeState(name: string, next: (value: any) => void) {\r\n  checkCCenterStatus();\r\n  const state = getStateByName(name);\r\n  if (!state) {\r\n    const errorMsg = `State: ${name} 不存在`;\r\n    console.error(errorMsg);\r\n    return null;\r\n  }\r\n  const subscription = state.observable.subscribe(next);\r\n  return {\r\n    unsubscribe: () => subscription.unsubscribe(),\r\n  };\r\n}\r\n\r\nexport function setState(name: string, value: any) {\r\n  checkCCenterStatus();\r\n  const state = getStateByName(name);\r\n  if (!state) {\r\n    const errorMsg = `State: ${name} 不存在`;\r\n    console.error(errorMsg);\r\n    return new Error(errorMsg);\r\n  }\r\n  state.value = value;\r\n  state.observable.next(value);\r\n}\r\n"],"names":[],"mappings":"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"}